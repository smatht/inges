{% extends "admin/base.html" %}
{% load admin_static %}

{# Additional <head> content here, some extra meta tags or favicon #}
{% block extrahead %}
<script src="/static/js/chart/highcharts.js" type="text/javascript"></script>
<script src="/static/js/chart/modules/exporting.js" type="text/javascript"></script>
<script type="text/javascript">
$(function () {
  a = "{{fact_iva}}";
  b = "{{desc_iva}}"
  ivaFact = parseFloat(a.replace(",","."), 10);
  descuento = parseFloat(b.replace(",","."), 10);
  diferencia = ivaFact - descuento;
  porc = (diferencia * 100) / (ivaFact + descuento + diferencia);
  slice = ((porc < 30) ? true : false);
  $('#grafico-iva').highcharts({
    chart: {
      plotBackgroundColor: null,
      plotBorderWidth: null,
      plotShadow: false
    },
    title: {
      text: 'DISCRIMINACION DEL IVA DEL MES'
    },
    tooltip: {
      pointFormat: '{series.name}: <b>${point.y:.1f}</b>'
    },
    plotOptions: {
      pie: {
        allowPointSelect: false,
        cursor: 'pointer',
        dataLabels: {
          enabled: true,
          color: '#000000',
          connectorColor: '#000000',
          format: '<b>{point.name}</b>: {point.percentage:.1f} %'
        }
      }
    },
    series: [{
      type: 'pie',
      name: 'Cantidad',
      data: [

      ['Iva de facturacion', ivaFact],
      {
        name: 'Diferencia',
                    //y: ({{fact_iva}} - {{desc_iva}}),
                    y: diferencia,
                    sliced: slice,
                    selected: true
                  },
                  ['Descuento de Iva', descuento]

                  ]
                }]
              });

});
</script>
{% endblock %}


{# Additional CSS includes #}
{#{% block extrastyle %}#}
{# <link rel="stylesheet" type="text/css" href="{% static 'css/my_project.css' %}" media="all">#}
{#{% endblock %}#}


{# Additional JS files in footer, right before </body> #}
{#{% block extrajs %}#}
{# <script type="text/javascript" src="{% static 'js/my_project.js' %}"></script>#}
{#{% endblock %}#}


{# Footer links (left side) #}
{% block footer_links %}
<a href="/docs/" class="icon"><i class="icon-question-sign"></i>Reportar un problema</a>
{% endblock %}

{# Additional header content like notifications or language switcher #}
{% block header_content %}
{{ block.super }}

{# <div class="header-content">#}
{# <!-- First icon column -->#}
{# <div class="header-column icon">#}
{# <i class="icon-home"></i><br>#}
{# <i class="icon-cog"></i>#}
{# </div>#}
{# <div class="header-column" style="margin-right: 20px">#}
{# <a href="/" class="grey">Front-end</a><br>#}
{# <a href="" class="grey">One more link</a>#}
{# </div>#}
{# <!-- Second icon column -->#}
{# <div class="header-column icon">#}
{# <i class="icon-comment"></i>#}
{# </div>#}
{# <div class="header-column">#}
{# <a href="" class="grey">5 new messages</a>#}
{# </div>#}
{# </div>#}
{% endblock %}

{% block content-center %}
<div id="suit-center" class="suit-column">

  {% if not is_popup %}
  {% block breadcrumbs %}
  <ul class="breadcrumb">
    <li><a href="{% url 'admin:index' %}">Inicio</a>
      {% if title %}
      <span class="divider">&raquo;</span>
    </li>
    <li class="active">
      {{ title }}
      {% endif %}
    </li>
  </ul>
  {% endblock %}
  {% endif %}

  {% block messages %}
  {% if messages %}

  {% for message in messages %}
  <div class="alert alert-{% firstof message.tags 'info' %}">
    <button class="close" data-dismiss="alert">Ã—</button>
    {{ message }}
  </div>
  {% endfor %}
  {% endif %}
  {% endblock messages %}

  <!-- Content -->
  <div id="content" class="{% block coltype %}colM{% endblock %} row-fluid">
    {% block pretitle %}{% endblock %}
    {% block content_title %}{% if title %}
    <h2 class="content-title">{{ title }}</h2>
    {% endif %}{% endblock %}
    {% block content %}

    <!-- ///////////////////////// -->
    <!--       FORM BUSQUEDA       -->
    <!-- ///////////////////////// -->
    <form class="form-inline" action="" method="get">
      <input type="month" placeholder="mes" name="fecha">
      {#{% csrf_token %}#}
      <button type="submit" class="btn">Mostrar</button>
    </form>
    <!-- ///////////////////////// -->
    <!--          FIN FORM         -->
    <!-- ///////////////////////// -->


    <!-- ///////////////////////// -->
    <!--      SECCION GASTOS       -->
    <!-- ///////////////////////// -->
    <table class="table table-bordered table-condensed table-striped">
      <thead>
        <tr>
          <th style="background-color: #FFF898">Gastos sin IVA</th>
          <th>Gastos con IVA</th>
          <th>IVA</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="table-gastoSI" style="background-color: #EFDFBF">${{gastoSIva|floatformat:"2"}}</td>
          <td class="table-gastoCI" style="background-color: #F3C0AF">${{gastoCIva|floatformat:"2"}}</td>
          <td class="table-gastoIVA" style="background-color: #AEBBBF">${{fact_iva|floatformat:"2"}}</td>
        </tr>
      </tbody>
    </table>
    <a href="#tabla-detalles">Ver detalle de facturas</a>
    <!-- ///////////////////////// -->
    <!--        FIN SECCION        -->
    <!-- ///////////////////////// -->


    <div id="grafico-iva"></div>


    <!-- /////////////////////////////////// -->
    <!-- SECCION TABLA DE DETALLES RECIBIDAS -->
    <!-- /////////////////////////////////// -->
    {% if detalleFacturasR %}
    <a name="tabla-detalles"></a>
    <table class="table table-bordered table-condensed table-striped">
      <thead>
        <tr>
          <th colspan="6" class="text-center">Detalle de facturas recibidas</th>
        </th>
        <tr>
          <th>Emisor</th>
          <th>Fecha</th>
          <th>Neto</th>
          <th>IVA</th>
          <th>P/Otros</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in detalleFacturasR %}
        <tr>
          <th>{{item.emisor}}</th>
          <th>{{item.fecha}}</th>
          <th>{{item.neto}}</th>
          <th>{{item.impuesto}}</th>
          <th>{{item.percepciones_otros}}</th>
          <th>{{item.total}}</th>
        </tr>
        {% endfor %}
        <tr>
          <td></td>
          <td> </td>
          <td class="table-gastoSI" style="background-color: #EFDFBF">${{gastoSIva|floatformat:"2"}}</td>
          <td class="table-gastoIVA" style="background-color: #AEBBBF">${{fact_iva|floatformat:"2"}}
            <td>${{percep_otros|floatformat:"2"}}</td>
            <td class="table-gastoCI" style="background-color: #F3C0AF">${{gastoCIva|floatformat:"2"}}</td>
          </td>
        </tr>
      </tbody>
    </table>
    {% endif %}
    <!-- ///////////////////////// -->
    <!--        FIN SECCION        -->
    <!-- ///////////////////////// -->

    <!-- ////////////////////////////////// -->
    <!-- SECCION TABLA DE DETALLES EMITIDAS -->
    <!-- ////////////////////////////////// -->
    {% if detalleFacturasE %}
    <a name="tabla-detalles"></a>
    <table class="table table-bordered table-condensed table-striped">
      <thead>
        <tr>
          <th colspan="6" class="text-center">Detalle de facturas emitidas</th>
        </th>
        <tr>
          <th>Fecha</th>
          <th>Ente</th>
          <th>Nro factura</th>
          <th>Neto C/IVA</th>
          <th>Valor IVA</th>
        </tr>
      </thead>
      <tbody>
        {% for item in detalleFacturasE %}
        <tr>
          <th>{{item.fecha}}</th>
          <th>{{item.ente}}</th>
          <th>{{item.nro_factura}}</th>
          <th>{{item.neto_iva}}</th>
          <th>{{item.iva|floatformat:"2"}}</th>
        </tr>
        {% endfor %}
        <!-- <tr>
          <td></td>
          <td> </td>
          <td class="table-gastoSI" style="background-color: #EFDFBF">${{gastoSIva|floatformat:"2"}}</td>
          <td class="table-gastoIVA" style="background-color: #AEBBBF">${{fact_iva|floatformat:"2"}}
            <td>${{percep_otros|floatformat:"2"}}</td>
            <td class="table-gastoCI" style="background-color: #F3C0AF">${{gastoCIva|floatformat:"2"}}</td>
          </td>
        </tr> -->
      </tbody>
    </table>
    {% endif %}
    <!-- ///////////////////////// -->
    <!--        FIN SECCION        -->
    <!-- ///////////////////////// -->
    <button type="button" class="print btn btn-warning" onclick="javascript:window.print()">Imprimir</button>

    {% block object-tools %}{% endblock %}
    {{ content }}
    {% endblock %}
    {% block sidebar_content %}
    {% block sidebar %}{% endblock %}
    {% endblock %}
  </div>
  <!-- END Content -->
</div>
{% endblock %}



{# Footer branding name (center) #}
{#{% block footer_branding %}#}
{#{% endblock %}#}


{# Footer copyright (right side) #}
{% block copyright %}
Copyright &copy; 2013 Inges<br>Desarrollado por <a href="http://sticchimatias.com.ar" target="_blank">Sticchi Matias G.</a>
{% endblock %}